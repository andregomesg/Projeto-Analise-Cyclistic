---
title: 'An√°lise do padr√£o de utiliza√ß√£o do servi√ßo de compartilhamento de bicicletas'
author: "Andr√© Christian F G Almeida"
date: "2024-08-20"
output:
html_document: default
 
---

Nos foi apresentado a Cyclistic, uma empresa de mobilidade com foco na sustentabilidade e compartilhamento de bicicletas de diversos tipos como: reclin√°veis, triciclos manuais e de carga. Hoje, ela conta com mais de 5.800 unidades e cerca de 692 esta√ß√µes de compartilhamento em Chicago.

## Identifica√ß√£o da tarefa de neg√≥cios, desafios e principais stakeholders.

Hoje a Cyclistic tem um desafio: Aumentar a taxa de convers√£o de **membros casuais** (aqueles que assinam os planos di√°rios e mensais) em **membros Cyclistic** (aqueles que assinam planos anuais). Atrav√©s dos dados podemos realizar an√°lises explorat√≥rias e descritivas para descobrir o padr√£o de utiliza√ß√£o dos membros, como: horas utilizadas, trajeto efetuado, quantidade de uso em determinado per√≠odo etc.

**Principais tarefas**

- Baixar os dados de utiliza√ß√£o de todos os clientes dos √∫ltimos 12 meses
- Realizar a estrutura√ß√£o dos dados
- Realizar a limpeza dos dados
- Realizar a an√°lise explorat√≥ria dos dados
- Realizar a an√°lise descritiva dos dados
- Apresentar para os stakeholders

**Stakeholders e seu objetivo**

A Lily Moreno, diretora de Marketing e respons√°vel pelas campanhas de e-mail, m√≠dias e outros canais juntamente com a sua equipe de marketing desejam descobrir tend√™ncias atrav√©s dos dados hist√≥ricos.

**Conclus√£o**

Ao analisar os dados fornecidos e gerar insights, podemos auxiliar o setor de Marketing a criar campanhas estrat√©gicas, a fim de converter os clientes casuais em membros Cyclistic respondendo as seguintes perguntas:

1.  Como os membros Cyclistic e ciclistas casuais usam as bicicletas da Cyclistic de forma diferente?
2.  Por que os ciclistas casuais iriam querer adquirir planos anuais da Cyclistic?
3.  Como a Cyclistic pode usar a m√≠dia digital para influenciar os passageiros casuais a se tornarem membros cyclistic?

```         
üí° Com esta entrega, finalizamos a primeira etapa de um processo de an√°lise de dados: Perguntar
```

### Prepara√ß√£o e Armazenamento dos Dados

Os dados da Cyclistic (nome f√≠tcio para compartilhar os dados) foram fornecidos atrav√©s de um [link](https://divvy-tripdata.s3.amazonaws.com/index.html) sob uma [licen√ßa](https://www.divvybikes.com/data-license-agreement) pela Divvy, empresa operada pela Motivate International Inc., uma entidade reconhecida e respeitada no setor de compartilhamento de bicicletas.

Coletados de forma autom√°tica pelos sistema de compartilhamento, os dados sugerem uma coleta consistente e precisa, no entanto, foram identificados valores nulos, que ser√£o tratados e validados.

Embora os dados abrangem um per√≠odo extenso (desde 2015), iremos focar na atualidade e analisar somente os √∫ltimos 12 meses, garantindo uma an√°lise baseada em informa√ß√µes recentes e relevantes. Por se tratar de uma an√°lise an√¥nima, n√£o h√° preocupa√ß√µes com vi√©s de relato/relat√≥rio, no entanto, vale ressaltar que √© poss√≠vel termos vieses na coleta, como o impacto de eventos sazonais ou altera√ß√µes no servi√ßo.

Levando em considera√ß√£o os pontos cruciais citados, como: Precis√£o, Atualidade, Objetividade, Vi√©s, Integridade e Licenciamento, podemos garantir que os dados utilizados ser√£o confi√°veis e apropriados para an√°lise. Fortalecendo a confiabilidade das conclus√µes tiradas.

**Etapas de processamento** 

1. Download dos arquivos 
2. Extra√ß√£o de cada um das respectivas pastas zips
3. Jun√ß√£o dos arquivos csv‚Äôs extra√≠dos na pasta local ‚ÄúProjetoAnaliseCyclistic‚Äù
4. Cria√ß√£o o dataframe com todos os arquivos

```{r Carregamento das bibliotecas, include=FALSE}
# Carregamento das bibliotecas
  library(summarytools)
  library(tidyverse)
  library(lubridate)
  library(knitr)
```

```{r Defini√ß√£o do diret√≥rio dos arquivos}
# Defini√ß√£o do diret√≥rio dos arquivos
diretorio <- "C:/Users/Andr√©/Documents/ProjetoBike/ProjetoAnaliseCyclistic"
```

```{r Leitura de cada arquivo csv}
# Leitura de cada arquivo csv
arquivos <- list.files(diretorio, pattern = "*.csv", full.names = TRUE)
```

```{r Listagem dos arquivos existentes na pasta}
# Listagem dos arquivos existentes na pasta
  leitura_arq <- function(file){
  read.csv(file)
  }
```

```{r Cria√ß√£o do dataframe com os arquivos existentes}
# Cria√ß√£o do dataframe com os arquivos existentes
 df_historico <- map_df(arquivos, leitura_arq)
```

```{r}
# Visualiza√ß√£o das vari√°veis e seus tipos
str(df_historico)
```


```         
üí° Com esta entrega, finalizamos a segunda etapa de um processo de an√°lise de dados: Preparar para explora√ß√£o
```

### Processamento dos dados

Para esta etapa temos que: 
* Verificar se h√° valores nulos 
* Verificar se h√° valores duplicados 
* Convers√£o das colunas started_at e ended_at de texto para data 
* Cria√ßao das coluna duration_trip, que mostra a dura√ß√£o de cada viagem 
* Cria√ß√£o da coluna day_of_the_week, que mostra que dia da semana cada viagem come√ßou

```{r Sum√°rio est√°tistico do data frame}
# Sum√°rio est√°tistico do data frame
df_summary <- dfSummary(df_historico)
  print(df_summary)
```

Identificamos que existem valores ride_id duplicados e colunas com valores em branco. N√£o iremos preencher as colunas com valores estat√≠sticos pois a quantidade de registro √© baixa, dessa forma, iremos excluir as linhas com valores nulos/v√°zios.

```{r Remove as linhas duplicadas com base na coluna ride_id}
# Remove as linhas duplicadas com base na coluna ride_id
  df_historico_limpo <- df_historico %>%
    distinct(ride_id, .keep_all = TRUE)
```

```{r Verifica√ß√£o se ainda h√° linhas duplicadas}
# Verifica√ß√£o se ainda h√° linhas duplicadas
existe_duplicadas <- df_historico_limpo %>%
  filter(duplicated(ride_id) | duplicated(ride_id, fromLast = TRUE)) %>%
  nrow() > 0
print(existe_duplicadas)
```

```{r Verifica√ß√£o se h√° pelo menos um valor nulo ou vazio em cada linha}
# Verifica√ß√£o se h√° pelo menos um valor nulo ou vazio em cada linha
verifica_vazio_ou_nulo <- function(x) {
  if (is.character(x)) {
    return(is.na(x) | x == "")
  } else {
    return(is.na(x))
  }
}
```

```{r Aplicar a fun√ß√£o para cada linha do dataframe}
# Aplicar a fun√ß√£o para cada linha do dataframe
linha_com_problemas <- apply(df_historico_limpo, 1, function(row) any(verifica_vazio_ou_nulo(row)))
```

```{r Filtrar o dataframe para remover as linhas com erros e manter o dataframe original}
# Filtrar o dataframe para remover as linhas com erros e manter o dataframe original
df_historico_limpo <- df_historico_limpo[!linha_com_problemas, ]
```

```{r Exibi√ß√£o da quantidade de linhas antes e depois da limpeza}
# Exibi√ß√£o da quantidade de linhas antes e depois da limpeza
numero_de_linhas_antes <- nrow(df_historico)
 numero_de_linhas_depois <- nrow(df_historico_limpo)

  print(paste("N√∫mero de linhas antes da limpeza: ", numero_de_linhas_antes))
  print(paste("N√∫mero de linhas depois da limpeza: ", numero_de_linhas_depois))

```

```{r Adiss√£o da coluna "duration_trip" ao dataframe}
# Adiss√£o da coluna "duration_trip" ao dataframe
# convers√£o da colunas started_at e ended_at para "difftime"
  df_historico_limpo$started_at <- ymd_hms(df_historico_limpo$started_at)
  df_historico_limpo$ended_at <- ymd_hms(df_historico_limpo$ended_at)
# Calculo da dura√ß√£o e convers√£o para minutos arrendondados para cima
  df_historico_limpo <- df_historico_limpo %>% 
    mutate(duration_trip = ceiling(difftime(ended_at, started_at, units = "mins"))) #em minutos
```

```{r Cria√ß√£o da coluna day_of_the_week}
# Cria√ß√£o da coluna day_of_the_week
 df_historico_limpo <- df_historico_limpo %>%
    mutate(day_of_the_week = wday(started_at, label = TRUE))
```

```         
Com esta entrega, finalizamos a terceira etapa de um processo de an√°lise de dados: Processar
```

### An√°lise Explorat√≥ria e Descritiva do Dataframe

```{r Cria√ß√£o de um novo sum√°rio com os dados limpos}
# Cria√ß√£o de um novo sum√°rio com os dados limpos
df_summary <- dfSummary(df_historico_limpo)
  print(df_summary)
```

#### An√°lise explorat√≥ria

```         
üí° O tipo de bicicleta com menor frequ√™ncia de uso s√£o as docked_bike (bicicletas cargueiras), com 1.2% dos registros e as classic_bike(bicicletas comuns) dominam, com 65.0% dos registros
```

```         
 De 5272212 registros, 36% s√£o de membros casuais e 64% de membros Cyclistic
```

```         
 A dura√ß√£o m√©dia de uma viagem √© de 11 minutos
```

```{r O dia em que os clientes mais utilizam o servi√ßo}

freq_day_of_the_week <- table(df_historico_limpo$day_of_the_week)
moda <- names(freq_day_of_the_week)[which.max(freq_day_of_the_week)]
print(paste("O dia da semana em que os clientes mais utilizam o servi√ßo √© no(a)", moda ))
```

```{r O tipo de bicicleta que mais utilizam}

freq_rideable_type <- table(df_historico_limpo$rideable_type)
moda <- names(freq_rideable_type[which.max(freq_rideable_type)])
print(paste("O tipo de bicicleta que os clientes mais utilizam s√£o as ", moda))
```

#### An√°lise descritiva

```{r Compara√ß√£o da quantidade de viagem segundo o tipo de bicicleta segmentado por tipo de membro}
title_text <- str_wrap("Quantidade de viagens por tipo de bicicleta e membro")
subtitle_text <- str_wrap("Ambos os membros utilizam os modelos de bicicleta de forma parecida, sendo a cl√°ssica a principal escolha.")
  ggplot(data = df_historico_limpo) + 
    geom_bar(mapping = aes(x = rideable_type, fill = rideable_type)) + 
    facet_wrap(~member_casual) +
    labs(title = title_text,
       subtitle = subtitle_text, 
       y = "Quantidade de viagens", 
       x = "Tipos de bicicleta",
       fill = "Tipos de bicicleta") +
   scale_y_continuous(labels = scales::comma_format()) # separa√ß√£o de milhares
```

```{r Compara√ß√£o da quantidade de viagem por dia da semana segmentado por tipo de membro}
title_text <- str_wrap("Quantidade de viagens durante a semana por tipo de membro")
subtitle_text <- str_wrap("Os membros Cyclistic costumam utilizar as bicicletas durante a semana, enquanto os membros casuais tendem a utilizar o servi√ßo aos finais de semana")
  ggplot(data = df_historico_limpo) + 
  geom_bar(mapping = aes(x = day_of_the_week, fill = day_of_the_week)) + 
  facet_wrap(~member_casual) +
  labs(title = title_text,
       subtitle = subtitle_text,
       y = "Quantidade de viagens",
       x = "Dias da semana",
       fill = "Dias da semana") +
  scale_y_continuous(labels = scales::comma_format()) # separa√ß√£o de milhares
```

```{r Dura√ß√£o m√©dia de viagens segundo os dias da semana segmentado por tipo de membro}
title_text <- str_wrap("Dura√ß√£o m√©dia de viagens por dia da semana e tipo de membro")
    subtitle_text <- str_wrap("O tempo m√©dio de viagem dos membros casuais segue o padr√£o esperado, com viagens mais longas nos finais de semana. Enquanto os membros Cyclistic tamb√©m apresentam um comportamento semelhante.") 
df_historico_limpo %>%
 mutate(duration_trip_min = as.numeric(duration_trip, units = "mins")) %>%
 group_by(day_of_the_week, member_casual) %>%
    summarize(mean_duration_trip = mean(duration_trip_min), .groups = 'drop') %>%
    ggplot(aes(x = day_of_the_week, y = mean_duration_trip, fill = day_of_the_week)) + 
    geom_bar(stat = "identity") + 
    facet_wrap(~member_casual) +
labs(title = title_text,
     subtitle = subtitle_text, 
     y = "Dura√ß√£o m√©dia das viagens",
     x = "Dias da semana",
     fill = "Dias da semana")

```

### Resumo da an√°lise

Analisando a utiliza√ß√£o dos membros da Cyclistic do √∫ltimo ano (2023/05 - 2024-06) podemos concluir que:

-   Os membros **Cyclistic** utilizam mais o servi√ßo se comparado aos membros **casuais**
-   Ambos os perfis de membros preferem utilizar as bicicletas **cl√°ssicas** a **bicicletas el√©tricas**.
-   O dia mais comum de utiliza√ß√£o do servi√ßo s√£o aos **s√°bados**, o tipo de bicicleta mais utilizado √© a **bicicleta cl√°ssica**, e a viagens tem uma **m√©dia 11 minutos** de dura√ß√£o.
-   **Membros casuais** costumam utilizar o servi√ßo durante os finais de semana, dias normalmente relacionados com a pr√°tica de lazer.
-   **Membros Cyclistic** tem registro de viagens maiores no meio da semana (ter√ßa a quinta), dias que podem ter uma maior demanda de idas aos escrit√≥rios diante do contexto global de modalidades de locais de trabalho. No entanto, a m√©dia de dura√ß√£o das viagens se destaca aos finais de semana, apontando que al√©m de utiliz√°-las para trabalho, tamb√©m utilizam para uma poss√≠vel recrea√ß√£o.


```
üí° Com esta entrega, finalizamos a quinta etapa de um processo de an√°lise de dados: Compartilhar
``` 

### Recomenda√ß√µes com base na an√°lise
Recomenda√ß√µes para orientar as futuras campanhas de marketing com base na an√°lise:

1. Realiza√ß√£o de pesquisa com os membros para entender quais s√£o as principais empresas e institui√ß√£o dos utilizadores do servi√ßo para buscar parcerias corporativas ou descontos.
2. Captar mais dados a respeito dos membros para expandir o conhecimento, podendo ser poss√≠vel tra√ßar os diferentes tipos de persona. 
3. Cria√ß√£o de campanhas para converter os membros casuais em membros Cyclistic atrav√©s de benef√≠cios e rede de acesso.

### Recomenda√ß√µes de melhorias 

-   Configura√ß√£o de uma API para conectar diretamente ao Docker disponibilizado para realizar o download autom√°tico sempre que estiver dispon√≠vel.
-   Estudar as possibilidades e necessidades de cruzar os dados de longitude e latitude de cada esta√ß√£o de in√≠cio e fim para conseguir calcular a dist√¢ncia percorrida em cada viagem.

```
üí° Com esta entrega, finalizamos a sexta e √∫ltima etapa de um processo de an√°lise de dados: Agir
``` 
## Metodologia

Decidimos utilizar a ferramenta R para realizar a an√°lise para a equipe de marketing pela alta facilidade em realizar todo o processo de ETL. Precisamos instalar e configurar o ambiente R localmente para utilizar o terminal a partir do RStudio local, pois a limita√ß√£o de hardware nas ferramentas onlines, como: Rstudio e GoogleColab, impossibilitou a utiliza√ß√£o.